<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="nc7.javaproject.dao.FilmDao">

  <!-- 영화 정보 조회 -->
  <select id="findById" parameterType="int" resultMap="filmMap">
    select
      f.films_no,
      f.title,
      f.films_image_url,
      f.grade_no,
      f.descriptions,
      f.running_time,
      f.released_date,
      g.genres_no,
      g.name as genre_name
    from
      films f inner join films_genres fg on f.films_no = fg.films_no
               inner join genres g on fg.genres_no = g.genres_no
    where
      f.films_no = #{filmNo}
  </select>
  
  <!-- 영화 목록 조회 -->
  <select id="findAll" resultMap="filmMap">
    select
      f.films_no,
      f.title,
      f.films_image_url,
      f.grade_no,
      f.descriptions,
      f.running_time,
      f.released_date,
      g.genres_no,
      g.name as genre_name
    from
      films f inner join films_genres fg on f.films_no = fg.films_no
               inner join genres g on fg.genres_no = g.genres_no
    order by
      f.films_no desc
  </select>
  
  <!-- 영화 정보 삽입 -->
  <insert id="insert" parameterType="film">
    insert into films(title, films_image_url, grade_no, descriptions, running_time, released_date)
    values(#{title}, #{filmsImageUrl}, #{grade.gradeNo}, #{descriptions}, #{runningTime}, #{releasedDate})
  </insert>
  
  <!-- 영화 정보 수정 -->
  <update id="update" parameterType="film">
    update films set
      title = #{title},
      films_image_url = #{filmsImageUrl},
      grade_no = #{grade.gradeNo},
      descriptions = #{descriptions},
      running_time = #{runningTime},
      released_date = #{releasedDate}
    where films_no = #{filmsNo}
  </update>
  
  <!-- 영화 정보 삭제 -->
  <delete id="delete" parameterType="int">
    delete from films
    where films_no = #{filmNo}
  </delete>
  
  <!-- resultMap 정의 -->
  <resultMap type="film" id="filmMap">
    <id column="films_no" property="filmsNo" />
    <result column="title" property="title" />
    <result column="films_image_url" property="filmsImageUrl" />
    <result column="descriptions" property="descriptions" />
    <result column="running_time" property="runningTime" />
    <result column="released_date" property="releasedDate" />
    <association property="grade" javaType="grade">
      <id column="grade_no" property="gradeNo" />
      <result column="name" property="name" />
    </association>
    <collection property="genres" ofType="genre">
      <id column="genres_no" property="genresNo" />
      <result column="genre_name" property="name" />
    </collection>
  </resultMap>
</mapper>
