<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="nc7.mapp.dao.RatingDao">

  <!-- 모든 등급 정보 조회 -->
  <select id="findAll" resultMap="ratingMap">
    SELECT * FROM rating
  </select>
  
  <!-- 등급 정보 조회 by 사용자 번호 -->
  <select id="findByUserId" parameterType="int" resultMap="ratingMap">
    SELECT * FROM rating WHERE users_no = #{userId}
  </select>
  
  <!-- 등급 정보 조회 by 영화 번호 -->
  <select id="findByFilmId" parameterType="int" resultMap="ratingMap">
    SELECT * FROM rating WHERE films_no = #{filmId}
  </select>
  
  <!-- resultMap 정의 -->
  <resultMap type="nc7.mapp.vo.Rating" id="ratingMap">
    <!-- 기본 키 매핑 -->
    <id column="users_no" property="user.usersNo" />
    
    <!-- 다른 필드 매핑 -->
    <result column="rating_score" property="ratingScore" />
    
    <!-- 사용자 매핑 -->
    <association property="user" javaType="nc7.mapp.vo.User">
      <id column="users_no" property="usersNo" />
      <result column="name" property="name" />
    </association>
    
    <!-- 영화 매핑 -->
    <association property="film" javaType="nc7.mapp.vo.Film">
      <id column="films_no" property="filmsNo" />
      <result column="title" property="title" />
    </association>
  </resultMap>
</mapper>
